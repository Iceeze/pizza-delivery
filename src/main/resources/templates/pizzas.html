<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Доставка пиццы • Пицца</title>
    <link rel="icon" type="image/svg" href="/pizza-slice-solid.svg">
    <script src="https://kit.fontawesome.com/deaee54991.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<h1>Доставка пиццы в Перми</h1>
<header>
    <nav class="navbar">
        <ul>
            <li><a href="/"><i class="fa-solid fa-pizza-slice" style="color: #fbca18;"></i></a></li>
            <li><a href="/pizzas">Пицца</a></li>
            <li><a href="/sauces">Соусы</a></li>
            <li><a href="/juices">Напитки</a></li>
            <li><a href="/reviews">Отзывы</a></li>
            <li><a href="/contacts">Контакты</a></li>
            <li><a href="/cart" class="cart-link">
                <i class="fa-solid fa-cart-shopping"></i> Корзина
                <span th:if="${cart != null and cart.totalItems > 0}" class="cart-count" th:text="${cart.totalItems}">0</span>
            </a></li>
        </ul>
    </nav>
</header>
<main>
    <div>
        <h1>Выберите пиццу</h1>
        <div th:each="pizza : ${pizzas}" class="card">
            <img th:src="${pizza.imageUrl}" th:alt="${pizza.name}" width="200px">

            <div th:if="${pizza.badge}" class="product-badge" th:text="${pizza.badge}">
                Новинка
            </div>

            <h4 th:text="${pizza.name}">Название пиццы</h4>
            <p th:text="${pizza.description}">Описание пиццы</p>

            <!-- Форма для каждой пиццы -->
            <form th:action="@{/cart/add}" method="post" class="pizza-form" th:data-pizza-id="${pizza.id}">
                <input type="hidden" name="productId" th:value="${pizza.id}">
                <input type="hidden" name="quantity" value="1">
                <input type="hidden" name="size" value="medium">

                <!-- Выбор размера пиццы -->
                <div class="size-selector">
                    <label>
                        <input type="radio" name="size_radio" value="small"
                               th:data-price="${pizza.price * 0.7}">
                        Маленькая (25 см)
                    </label>
                    <label>
                        <input type="radio" name="size_radio" value="medium" checked
                               th:data-price="${pizza.price}">
                        Средняя (30 см)
                    </label>
                    <label>
                        <input type="radio" name="size_radio" value="large"
                               th:data-price="${pizza.price * 1.3}">
                        Большая (35 см)
                    </label>
                </div>

                <div class="pizza-actions">
                    <span class="price" th:text="${pizza.price} + ' руб.'"></span>
                    <button type="submit" class="order-btn">В корзину</button>
                </div>
            </form>
        </div>
    </div>
</main>
<footer>
    Доставка по всей Перми.<br>
    &copy; dmkcompany 2025<br>
    <a href="mailto:danichPerm2016@mail.ru">danichPerm2016@mail.ru</a>
</footer>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Обработчик для радиокнопок размера
        document.querySelectorAll('.size-selector input[type="radio"]').forEach(function(radio) {
            radio.addEventListener('change', function() {
                const form = this.closest('.pizza-form');
                const priceElement = form.querySelector('.price');
                const sizeInput = form.querySelector('input[name="size"]');
                const newPrice = this.getAttribute('data-price');

                // Обновляем цену
                priceElement.textContent = Math.round(newPrice) + ' руб.';

                // Обновляем скрытое поле с размером
                sizeInput.value = this.value;

                console.log('Size changed to:', this.value, 'Price:', newPrice);
            });
        });

        // Обработчик отправки формы для отладки
        document.querySelectorAll('.pizza-form').forEach(function(form) {
            form.addEventListener('submit', function(e) {
                const productId = this.querySelector('input[name="productId"]').value;
                const size = this.querySelector('input[name="size"]').value;
                console.log('Submitting form - Product ID:', productId, 'Size:', size);
            });
        });
    });
</script>
</body>
</html>